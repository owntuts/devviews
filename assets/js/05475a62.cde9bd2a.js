"use strict";(self.webpackChunkinterviewdev=self.webpackChunkinterviewdev||[]).push([[9259],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),u=r,h=c["".concat(i,".").concat(u)]||c[u]||m[u]||o;return n?a.createElement(h,s(s({ref:t},d),{},{components:n})):a.createElement(h,s({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=u;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[c]="string"==typeof e?e:r,s[1]=l;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4312:function(e,t,n){n.d(t,{ZP:function(){return l}});var a=n(3117),r=(n(7294),n(3905));const o={toc:[]},s="wrapper";function l(e){let{components:t,...n}=e;return(0,r.kt)(s,(0,a.Z)({},o,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"interview"},n.level&&(0,r.kt)("span",{className:"level"},n.level),n.children))}l.isMDXComponent=!0},9847:function(e,t,n){n.r(t),n.d(t,{assets:function(){return h},contentTitle:function(){return m},default:function(){return y},frontMatter:function(){return c},metadata:function(){return u},toc:function(){return g}});var a=n(3117),r=(n(7294),n(3905));n(4312);const o={toc:[]},s="wrapper";function l(e){let{components:t,...l}=e;return(0,r.kt)(s,(0,a.Z)({},o,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("details",{open:!0},(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Replication Architecture")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Replication Architecture",src:n(2240).Z,width:"3773",height:"2485"})),(0,r.kt)("p",null,"MongoDB uses a ",(0,r.kt)("strong",{parentName:"p"},"replica set")," as the basic unit of replication. A replica set is a group of ",(0,r.kt)("strong",{parentName:"p"},"mongod")," instances that maintain the same data set. "),(0,r.kt)("p",null,"A replica set contains one ",(0,r.kt)("strong",{parentName:"p"},"primary")," node and one or more ",(0,r.kt)("strong",{parentName:"p"},"secondary")," nodes. Optionally, it can also contain one or more ",(0,r.kt)("strong",{parentName:"p"},"arbiter")," nodes."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"The primary node")," ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"receives all write operations"))," and records them in its ",(0,r.kt)("strong",{parentName:"li"},"operation log"),", or ",(0,r.kt)("strong",{parentName:"li"},"oplog"),". "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"The secondary nodes")," ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"replicate the primary's oplog"))," and apply the operations to their data sets asynchronously. The secondary nodes ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"can also serve read operations")),", but they may not have the most up-to-date data."),(0,r.kt)("li",{parentName:"ul"},"If the primary node fails or becomes unavailable, one of the secondary nodes can hold an ",(0,r.kt)("strong",{parentName:"li"},"election")," to elect itself as the new primary. The election process ensures that there is always one and only one primary node in a replica set."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"An arbiter node")," is a special type of node that does ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"not hold any data")),", but ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"participates in elections")),". An arbiter node can ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"help maintain an odd number of voting members"))," in a replica set, which is necessary for electing a primary."))),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Some notes about replica set")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A replica set can have ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"up to 50 members")),", but ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"only 7 members can vote"))," in elections."),(0,r.kt)("li",{parentName:"ul"},"A replica set can have ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"only one primary node at a time")),", and it must have a majority of voting members online to elect or maintain a primary node."),(0,r.kt)("li",{parentName:"ul"},"A replica set ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"should have an odd number of voting members")),". If a replica set has an even number of voting members, and half of them vote for one candidate and half of them vote for another candidate, then there is no clear winner and the election fails."),(0,r.kt)("li",{parentName:"ul"},"A replica set can have different types of secondary nodes, such as hidden nodes, delayed nodes, or non-voting nodes, for different purposes."),(0,r.kt)("li",{parentName:"ul"},"A replica set can use authentication and encryption to secure the communication between the members."),(0,r.kt)("li",{parentName:"ul"},"A replica set can use tags to group the members by location, function, or hardware configuration. Tags can be used to control read preferences and write concerns."))),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Read and write concern in replica set")),(0,r.kt)("p",null,"Read and write concern in replica set are options that allow you to control the consistency and durability of the data read and written from replica sets."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To read data from the primary node only, you can use the following read concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ readConcern: { level: "local" } }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To read data that has been acknowledged by a majority of the replica set members, you can use the following read concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ readConcern: { level: "majority" } }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To read data that reflects all successful writes issued with a majority write concern and that are acknowledged by the current primary node, you can use the following read concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ readConcern: { level: "linearizable" } }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To read data from any available replica set member, regardless of whether the data may be rolled back or not, you can use the following read concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ readConcern: { level: "available" } }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To read data from a specific point in time that reflects the majority committed state of the data, you can use the following read concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ readConcern: { level: "snapshot" } }\n')),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"write concern",src:n(6188).Z,width:"455",height:"457"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To write data to the primary node only, you can use the following write concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{ writeConcern: { w: 1 } }\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To write data to a majority of the replica set members, you can use the following write concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ writeConcern: { w: "majority" } }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To write data to at least three replica set members, you can use the following write concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},"{ writeConcern: { w: 3 } }\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To write data to a specific set of replica set members that have a certain tag, you can use the following write concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ writeConcern: { w: "<tag>" } }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To write data with a timeout of 10 seconds, you can use the following write concern:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ writeConcern: { w: "majority", wtimeout: 10000 } }\n')),(0,r.kt)("p",null,":::note"),(0,r.kt)("p",null,"A majority of the replica set members is the smallest number of members that constitutes more than half of the voting members in the replica set. For example, if a replica set has 5 voting members, a majority is 3. If a replica set has 6 voting members, a majority is 4."),(0,r.kt)("p",null,":::"),(0,r.kt)("p",null,":::note"),(0,r.kt)("p",null,"You can specify read and write concerns for the following commands in MongoDB:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For read operations, you can use the ",(0,r.kt)("strong",{parentName:"li"},"find"),", ",(0,r.kt)("strong",{parentName:"li"},"aggregate"),", ",(0,r.kt)("strong",{parentName:"li"},"count"),", ",(0,r.kt)("strong",{parentName:"li"},"distinct"),", ",(0,r.kt)("strong",{parentName:"li"},"geoNear"),", and ",(0,r.kt)("strong",{parentName:"li"},"geoSearch")," commands with the ",(0,r.kt)("strong",{parentName:"li"},"readConcern")," option."),(0,r.kt)("li",{parentName:"ul"},"For write operations, you can use the ",(0,r.kt)("strong",{parentName:"li"},"insert"),", ",(0,r.kt)("strong",{parentName:"li"},"update"),", ",(0,r.kt)("strong",{parentName:"li"},"delete"),", and ",(0,r.kt)("strong",{parentName:"li"},"findAndModify")," commands with the ",(0,r.kt)("strong",{parentName:"li"},"writeConcern")," option."),(0,r.kt)("li",{parentName:"ul"},"For other commands that support read or write concerns, you can use the ",(0,r.kt)("strong",{parentName:"li"},"db.runCommand()")," method with the ",(0,r.kt)("strong",{parentName:"li"},"readConcern")," or ",(0,r.kt)("strong",{parentName:"li"},"writeConcern")," option. For example, you can use the ",(0,r.kt)("strong",{parentName:"li"},"createIndexes")," command with the ",(0,r.kt)("strong",{parentName:"li"},"writeConcern")," option as follows:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'db.runCommand( {\n   createIndexes: "products",\n   indexes: [\n      { key: { item: 1 }, name: "item_1" }\n   ],\n   writeConcern: { w: "majority" }\n} )\n')),(0,r.kt)("p",null,":::")),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Types of secondary nodes")),(0,r.kt)("p",null,"You can configure a secondary member for a specific purpose. You can configure a secondary to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Priority 0 Node"),": In MongoDB, The higher the priority, the more likely a node is to become the primary. The default priority is 1, and you can set it to any value between 0 and 1000. To prevent a node from becoming a primary in an election, which allows it to reside in a secondary data center or to serve as a cold standby. These are called ",(0,r.kt)("strong",{parentName:"li"},"priority 0")," replica set members."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Hidden Node"),": Prevent applications from reading from it, which allows it to run applications that require separation from normal traffic (",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"running in background")),"). These are called ",(0,r.kt)("strong",{parentName:"li"},"hidden")," replica set members (usually, ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"use for analytics")),")."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Delayed Node"),": Keep a ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},'running "historical" snapshot'))," for use in recovery from certain errors, such as unintentionally deleted databases. These are called ",(0,r.kt)("strong",{parentName:"li"},"delayed")," replica set members."))),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Deploy replicaset in mongodb")),(0,r.kt)("p",null,"First of all, to deploy a replica set in MongoDB, you need to ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"have at least three mongod instances"))," running on separate machines or on the same machine with different ports."),(0,r.kt)("p",null,"For example, if you have three mongod instances running on localhost with ports ",(0,r.kt)("inlineCode",{parentName:"p"},"27017"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"27018"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"27019"),", and you want to create a replica set named ",(0,r.kt)("inlineCode",{parentName:"p"},"rs0"),", you can do the following steps:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Start each mongod instance with the ",(0,r.kt)("inlineCode",{parentName:"li"},"--replSet rs0")," option. For example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"mongod --port 27017 --dbpath /data/db1 --replSet rs0\nmongod --port 27018 --dbpath /data/db2 --replSet rs0\nmongod --port 27019 --dbpath /data/db3 --replSet rs0\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Connect to one of the mongod instances with mongosh. For example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"mongosh --port 27017\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Initiate the replica set with the rs.initiate () command. For example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"rs.initiate ()\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add the other members to the replica set with the rs.add () command. For example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'rs.add ("localhost:27018")\nrs.add ("localhost:27019")\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Check the status of the replica set with the rs.status () command. For example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"rs.status ()\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"connect to replicaset using nodejs")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"var mongoose = require ('mongoose');\nvar uri = 'mongodb://user:pass@host1:port1,host2:port2/dbname?replicaSet=rsname';\nvar options = {\n  db: { native_parser: true },\n  replset: {\n    auto_reconnect:false,\n    poolSize: 10,\n    socketOptions: {\n      keepAlive: 1000,\n      connectTimeoutMS: 30000\n    }\n  },\n  server: {\n    poolSize: 5,\n    socketOptions: {\n      keepAlive: 1000,\n      connectTimeoutMS: 30000\n    }\n  }\n};\nmongoose.connect (uri, options);\n"))))}l.isMDXComponent=!0;const i={toc:[{value:"1. start config server replicaset mongodb",id:"1-start-config-server-replicaset-mongodb",level:4},{value:"2. Deploy - Start Shard Server Replicaset",id:"2-deploy---start-shard-server-replicaset",level:4},{value:"3. Deploy - Start a mongos for the Sharded Cluster",id:"3-deploy---start-a-mongos-for-the-sharded-cluster",level:4}]},p="wrapper";function d(e){let{components:t,...o}=e;return(0,r.kt)(p,(0,a.Z)({},i,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("details",{open:!0},(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Sharding Architecture")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"sharding",src:n(2998).Z,width:"840",height:"596"})),(0,r.kt)("p",null,"Sharding is a method for distributing data across multiple machines. It is useful when single machine can handle large modern-day workloads, by allowing you to scale horizontally."),(0,r.kt)("p",null,"In MongoDB, a sharded cluster consists of:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Shards"),": Each shard contains a subset of the cluster\u2019s data. Each shard can be deployed as a replica set."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Mongos"),": The mongos acts as a query router for client applications, handling both read and write operations. It dispatches client requests to the relevant shards and aggregates the result from shards into a consistent client response."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Config servers"),": Config servers store metadata and configuration settings for the cluster. The sharding metadata reflects the state and organization of the sharded data.")),(0,r.kt)("p",null,"MongoDB shards data at the collection level, using a ",(0,r.kt)("strong",{parentName:"p"},"shard key")," to distribute the collection's documents across shards. The shard key consists of a field or multiple fields in the documents. MongoDB splits the data into ",(0,r.kt)("strong",{parentName:"p"},"chunks"),", by dividing the span of shard key values into non-overlapping ranges. MongoDB then attempts to distribute those chunks evenly among the shards in the cluster.")),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"How it works")),(0,r.kt)("p",null,"We need to index Shards with ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"ranges of certain keys"))," (ranged sharding) or ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"hashes of keys"))," (hashed sharding)."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"sharding",src:n(6461).Z,width:"3616",height:"2038"}))),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Ranged Sharding")),(0,r.kt)("p",null,"Ranged sharding in MongoDB is a way of splitting up your data into smaller pieces called chunks and spreading them across different machines called shards. "),(0,r.kt)("p",null,"The process of ranged sharding: "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Routers => Look in config servers => Get metadata about shard key ranges and chunk locations (table) => Route requests to relevant shards => Aggregate results from shards => Send response to clients.")),(0,r.kt)("p",null,"To use ranged sharding, you need to run a command called ",(0,r.kt)("inlineCode",{parentName:"p"},"sh.shardCollection()")," and tell MongoDB which collection and which field you want to use as the shard key."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'sh.shardCollection("users.history", { user_id : 1 } )\n')),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"sharding",src:n(1125).Z,width:"4192",height:"1815"})),(0,r.kt)("p",null,"Some of the pros and cons of ranged sharding are:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pros:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"It allows for efficient queries where reads target documents within a contiguous range."),(0,r.kt)("li",{parentName:"ul"},"It is simple and easy to implement if you have a good understanding of your data and query patterns."),(0,r.kt)("li",{parentName:"ul"},"It is the default sharding methodology in MongoDB if you don't have any special requirements.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Cons:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"It can lead to uneven distribution or hotspots if the shard key values are not well distributed or have high frequency."),(0,r.kt)("li",{parentName:"ul"},"It can cause poor performance if the shard key values change monotonically (such as timestamps or auto-incrementing IDs) and create write bottlenecks on a single shard."),(0,r.kt)("li",{parentName:"ul"},"It can make cross-shard queries more difficult or inefficient if the query does not include the shard key or spans multiple chunks or shards."))),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Hashed Sharding")),(0,r.kt)("p",null,"Hashed sharding is a method for ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"distributing data across a MongoDB cluster based on a hashed index"))," of a shard key field. It provides a more even data distribution across the cluster than ranged sharding, but it reduces the ability to perform targeted operations on documents with close shard key values."),(0,r.kt)("p",null,"The process of ranged sharding: "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"look for that hash in table => find doc in what chunk")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"hashed-sharding",src:n(8284).Z,width:"4235",height:"1602"}))),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("h5",null,"Deploy sharding")),(0,r.kt)("p",null,"To deploy sharding in MongoDB, you need to set up a sharded cluster that consists of shards, mongos and config servers."),(0,r.kt)("h4",{id:"1-start-config-server-replicaset-mongodb"},"1. start config server replicaset mongodb"),(0,r.kt)("p",null,"To start the config server replica set in MongoDB, you need to follow these steps\xb9:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Start three mongod instances on separate machines as config servers. Use the ",(0,r.kt)("inlineCode",{parentName:"li"},"--configsvr")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"--replSet")," options to specify that the mongod instances are config servers and members of a replica set. For example, on one machine, you can use this command:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mongod --configsvr --replSet configReplSet --port 27019 --dbpath /data/configdb\n")),(0,r.kt)("p",null,"Replace the port number and dbpath with your own values. Repeat this step for the other two machines, using different port numbers and dbpaths."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Connect to one of the config servers using a mongo shell and initiate the config server replica set using this command:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'rs.initiate(\n   {\n      _id: "configReplSet",\n      configsvr: true,\n      members: [\n         { _id : 0, host : "config01.example.net:27019" },\n         { _id : 1, host : "config02.example.net:27019" },\n         { _id : 2, host : "config03.example.net:27019" }\n      ]\n   }\n)\n')),(0,r.kt)("p",null,"Replace the host names and port numbers with your own values."),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Verify that the config server replica set is running by using this command:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"rs.status()\n")),(0,r.kt)("h4",{id:"2-deploy---start-shard-server-replicaset"},"2. Deploy - Start Shard Server Replicaset"),(0,r.kt)("p",null,"To start the shard server replica set in MongoDB, you need to follow these steps\xb9:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Start each member of the replica set with the appropriate options. For each member, start a mongod instance with the following settings:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"--shardsvr")," option to indicate that the mongod instance is a shard."),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"--replSet")," option to specify the name of the shard replica set."),(0,r.kt)("li",{parentName:"ul"},"Set ",(0,r.kt)("inlineCode",{parentName:"li"},"--bind_ip")," option to specify the hostname/ip or a comma-delimited list of hostnames/ips that remote clients can use to connect to the instance."),(0,r.kt)("li",{parentName:"ul"},"Set any other settings as appropriate for your deployment.")),(0,r.kt)("p",null,"For example, on one machine, you can use this command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mongod --shardsvr --replSet shardReplSet --bind_ip localhost,<hostname(s)|ip address(es)>\n")),(0,r.kt)("p",null,"Replace the hostname(s) and ip address(es) with your own values. Repeat this step for the other members of the shard replica set, using different port numbers and dbpaths."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Connect to one of the shard servers using a mongo shell and initiate the shard replica set using this command:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'rs.initiate(\n   {\n      _id: "shardReplSet",\n      members: [\n         { _id : 0, host : "shard01.example.net:27018" },\n         { _id : 1, host : "shard02.example.net:27018" },\n         { _id : 2, host : "shard03.example.net:27018" }\n      ]\n   }\n)\n')),(0,r.kt)("p",null,"Replace the host names and port numbers with your own values."),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Verify that the shard server replica set is running by using this command:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"rs.status()\n")),(0,r.kt)("h4",{id:"3-deploy---start-a-mongos-for-the-sharded-cluster"},"3. Deploy - Start a mongos for the Sharded Cluster")))}d.isMDXComponent=!0;const c={sidebar_position:3,id:"mongodb-zero-to-hero",sidebar_label:"MongoDB Zero To Hero",title:"MongoDB Zero To Hero"},m="MongoDB Zero To Hero",u={unversionedId:"mongodb/mongodb-zero-to-hero",id:"mongodb/mongodb-zero-to-hero",title:"MongoDB Zero To Hero",description:"\x3c!--",source:"@site/docs/mongodb/1.intro.md",sourceDirName:"mongodb",slug:"/mongodb/mongodb-zero-to-hero",permalink:"/devviews/interviews/mongodb/mongodb-zero-to-hero",draft:!1,editUrl:"https://github.com/owntuts/devviews/edit/main/docs/mongodb/1.intro.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,id:"mongodb-zero-to-hero",sidebar_label:"MongoDB Zero To Hero",title:"MongoDB Zero To Hero"},sidebar:"mongodbInterviewSidebar"},h={},g=[{value:"Horizontal Scale",id:"horizontal-scale",level:3},{value:"Sharding",id:"sharding",level:3}],k={toc:g},f="wrapper";function y(e){let{components:t,...n}=e;return(0,r.kt)(f,(0,a.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"mongodb-zero-to-hero"},"MongoDB Zero To Hero"),(0,r.kt)("h2",{id:""}),(0,r.kt)("h3",{id:"horizontal-scale"},"Horizontal Scale"),(0,r.kt)(l,{mdxType:"HorizontalScale"}),(0,r.kt)("h3",{id:"sharding"},"Sharding"),(0,r.kt)(d,{mdxType:"Sharding"}))}y.isMDXComponent=!0},8284:function(e,t,n){t.Z=n.p+"assets/images/hashed-sharding-a9026ed31c35837e24783eda7485d228.png"},1125:function(e,t,n){t.Z=n.p+"assets/images/range-sharding-dc28234315eb9fb3a5c1e92a5da009d3.png"},2240:function(e,t,n){t.Z=n.p+"assets/images/replicaset-e59b15b81df17b40ce1b0aa0881e063b.png"},6461:function(e,t,n){t.Z=n.p+"assets/images/sharding-works-bc52ec6b4fdf3ffca1c9839ef8d78896.png"},2998:function(e,t,n){t.Z=n.p+"assets/images/sharding-126b9d1e63e56eeea235a112c83a6024.png"},6188:function(e,t,n){t.Z=n.p+"assets/images/write-concern-4dad5d749b8b0390414806229a6ae918.png"}}]);